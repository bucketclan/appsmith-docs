"use strict";(self.webpackChunkappsmith_docs=self.webpackChunkappsmith_docs||[]).push([[4926],{3905:(e,n,t)=>{t.d(n,{Zo:()=>m,kt:()=>h});var r=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)t=o[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),p=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},m=function(e){var n=p(e.components);return r.createElement(s.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},u=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),u=p(t),h=a,d=u["".concat(s,".").concat(h)]||u[h]||c[h]||o;return t?r.createElement(d,i(i({ref:n},m),{},{components:t})):r.createElement(d,i({ref:n},m))}));function h(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var o=t.length,i=new Array(o);i[0]=u;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var p=2;p<o;p++)i[p]=t[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}u.displayName="MDXCreateElement"},1695:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var r=t(87462),a=(t(67294),t(3905));const o={},i="JavaScript Promises",l={unversionedId:"core-concepts/writing-code/javascript-promises",id:"core-concepts/writing-code/javascript-promises",title:"JavaScript Promises",description:"Previously, the only way to achieve asynchronous workflows in Appsmith was through callbacks, and dealing with callbacks was not easy. Appsmith now supports native JavaScript promises to make working with asynchronous workflows easier.",source:"@site/docs/core-concepts/writing-code/javascript-promises.md",sourceDirName:"core-concepts/writing-code",slug:"/core-concepts/writing-code/javascript-promises",permalink:"/core-concepts/writing-code/javascript-promises",draft:!1,editUrl:"https://github.com/bucketclan/appsmith-docs/blob/v1.5/website/docs/core-concepts/writing-code/javascript-promises.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Creating Workflows",permalink:"/core-concepts/writing-code/workflows"},next:{title:"External Libraries",permalink:"/core-concepts/writing-code/ext-libraries"}},s={},p=[{value:"Async/Await",id:"asyncawait",level:3},{value:"Async",id:"async",level:4},{value:"Await",id:"await",level:4},{value:"Promise methods",id:"promise-methods",level:3},{value:"Promise.any()",id:"promiseany",level:4},{value:"Promise.race()",id:"promiserace",level:4},{value:"Promise.all()",id:"promiseall",level:4},{value:"Promise.allSettled()",id:"promiseallsettled",level:4},{value:"<strong>Using Promises in Appsmith</strong>",id:"using-promises-in-appsmith",level:3}],m={toc:p};function c(e){let{components:n,...t}=e;return(0,a.kt)("wrapper",(0,r.Z)({},m,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"javascript-promises"},"JavaScript Promises"),(0,a.kt)("p",null,"Previously, the only way to achieve asynchronous workflows in Appsmith was through callbacks, and dealing with callbacks was not easy. Appsmith now supports native ",(0,a.kt)("a",{parentName:"p",href:"https://javascript.info/promise-basics"},"JavaScript promises")," to make working with asynchronous workflows easier."),(0,a.kt)("figure",null,(0,a.kt)("object",{data:"https://www.youtube.com/embed/VuBycqPJVug?autoplay=0",width:"750px",height:"400px"}),(0,a.kt)("figcaption",{align:"center"},(0,a.kt)("i",null,"How to use JS Promises and Async/Await"))),(0,a.kt)("p",null,"All Appsmith APIs like ",(0,a.kt)("a",{parentName:"p",href:"broken-reference"},(0,a.kt)("inlineCode",{parentName:"a"},"showAlert()")),", ",(0,a.kt)("a",{parentName:"p",href:"broken-reference"},(0,a.kt)("inlineCode",{parentName:"a"},"showModal()")),", ",(0,a.kt)("a",{parentName:"p",href:"broken-reference"},(0,a.kt)("inlineCode",{parentName:"a"},"storeValue()")),", ",(0,a.kt)("a",{parentName:"p",href:"broken-reference"},(0,a.kt)("inlineCode",{parentName:"a"},"navigateTo()"))," etc., will return a promise, making asynchronous workflow's implementation easier and readable."),(0,a.kt)("p",null,'To understand the difference between callbacks and Promise implementation, let\'s try to implement the logic where we run three APIs each after the success of the previous one and finally show an alert with a message as "done."'),(0,a.kt)("admonition",{type:"info"},(0,a.kt)("p",{parentName:"admonition"},"MockApi is a query created inside Appsmith, which takes a name as a parameter.")),(0,a.kt)("p",null,"Old Callback implementation looks like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"{{   \nMockApi.run(() => {\n    MockApi1.run(() => {\n        MockApi2.run(() => {\n            showAlert('done') \n            })\n     })      \n}) \n}}\n")),(0,a.kt)("p",null,"However, using Promise for the same problem makes the implementation easier and readable."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"{{\n    MockApi.run()\n        .then(() => MockApi1.run())\n        .then(() => MockApi2.run())\n        .then(() => showAlert('done'))\n }}\n")),(0,a.kt)("h3",{id:"asyncawait"},"Async/Await"),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"async")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"await")," keywords enable the ",(0,a.kt)("a",{parentName:"p",href:"javascript-editor-beta/#asynchronous"},"asynchronous")," workflow to be written in a cleaner style, avoiding the need to configure promise chains explicitly."),(0,a.kt)("h4",{id:"async"},"Async"),(0,a.kt)("p",null,"Adding the ",(0,a.kt)("inlineCode",{parentName:"p"},"async")," keyword before a function means one simple thing: a function always returns a promise. Other values are wrapped in a resolved promise automatically."),(0,a.kt)("h4",{id:"await"},"Await"),(0,a.kt)("p",null,"The keyword ",(0,a.kt)("inlineCode",{parentName:"p"},"await")," makes JavaScript wait until that Promise settles and returns its result."),(0,a.kt)("p",null,"Let's take an example to understand these keywords. Refer to the code below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"{{ \n(async function(){ \n    const response = await MockApi.run({ name: 'Appsmith' }); \n    await storeValue( \"name\", response.args.name ); \n    await showAlert(appsmith.store.name); \n    })() \n}}\n")),(0,a.kt)("p",null,"In the example above:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"We run ",(0,a.kt)("inlineCode",{parentName:"li"},"MockApi"),' with the parameter name as "Appsmith" and wait for the response.'),(0,a.kt)("li",{parentName:"ol"},"We store the response in the Appsmith store using ",(0,a.kt)("inlineCode",{parentName:"li"},"storeValue")," when we get the response."),(0,a.kt)("li",{parentName:"ol"},"On completion of ",(0,a.kt)("inlineCode",{parentName:"li"},"storeValue"),", we show an alert with a message.")),(0,a.kt)("h3",{id:"promise-methods"},"Promise methods"),(0,a.kt)("p",null,"If you want only one action/promise to finish for further execution, you can use ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise.any()")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise.race()")," methods."),(0,a.kt)("admonition",{type:"caution"},(0,a.kt)("p",{parentName:"admonition"},"Please remember to always return the promise for ",(0,a.kt)("inlineCode",{parentName:"p"},".then"),"or ",(0,a.kt)("inlineCode",{parentName:"p"},".catch")," blocks to work as expected.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"{{\n  (function() {\n      \u274c   MockApi.run().then(() => showAlert(`Success`))    \n      \u2705   return MockApi.run().then(() => showAlert(`Success`)) \n   })()\n}}\n")),(0,a.kt)("p",null,"{% endhint %}"),(0,a.kt)("h4",{id:"promiseany"},"Promise.any()"),(0,a.kt)("p",null,"It takes an iterable of Promise objects. Once one of the promises is fulfilled it returns a single promise that resolves with that Promise's value."),(0,a.kt)("p",null,"For example, refer to the code below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{{\n(function(){\n    \n  return Promise.any([\n        MockApi.run({ name: 1 }), // if name:1 finished early\n        MockApi.run({ name: 2 })\n  ]).then((res) => {\n    showAlert(`Winner: ${res.args.name}`) // Alert Message will be "Winner: 1" \n  });\n})()\n}}\n')),(0,a.kt)("p",null,"Here, We ran multiple ",(0,a.kt)("inlineCode",{parentName:"p"},"MockApi")," with a parameter name as a unique number (e.g., 1, 2) and passed the returned Promise to ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise.any()"),". When any actions are fulfilled, we show an alert message containing the argument sent to API, which finished faster."),(0,a.kt)("h4",{id:"promiserace"},"Promise.race()"),(0,a.kt)("p",null,"It simply waits for the first settled Promise, fulfilled or rejected, to get its result."),(0,a.kt)("p",null,"Let's take an example to understand ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise.race()"),". Refer to the code below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"{{\n(function(){\n    \n return Promise.race([\n        MockApi.run({ name: 1 }),\n        MockApi.run({ name: 2 })\n  ]).then((res) => {\n    showAlert(`Winner: ${res.args.name}`)\n  });\n\n})()\n}}\n")),(0,a.kt)("p",null,"In the example above:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"We run multiple ",(0,a.kt)("inlineCode",{parentName:"li"},"MockApi")," with a parameter name as a unique number (e.g., 1, 2);"),(0,a.kt)("li",{parentName:"ol"},"We pass the returned Promise to ",(0,a.kt)("inlineCode",{parentName:"li"},"Promise.race()"),";"),(0,a.kt)("li",{parentName:"ol"},"We show an alert message containing the argument sent to API, which finishes faster.")),(0,a.kt)("p",null,"If you want all the actions to finish first, you can use ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise.all()")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"Promise.allSettled()")," for such cases."),(0,a.kt)("h4",{id:"promiseall"},"Promise.all()"),(0,a.kt)("p",null,"It takes an array of promises (technically any iterable but is usually an array) and returns a new Promise. The array of results of the Promises becomes the result of the new Promise. If any promises fail (reject state), the new Promise immediately rejects and returns the same error."),(0,a.kt)("p",null,"For example, Refer to the code below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"{{\n(function(){\n\n  let employeeNames = [\"Employee 1\",\"Employee 2\"];\n\n  // Start a bunch of calls running in parallel and store returned promise\n  const calls = employeeNames.map(employeeName => MockApi.run({ name: employeeName }));\n  \n  // Wait for all to finish (or any to reject).\n  return Promise.all(calls)\n        .then(() => showAlert('Promise.all - All successful'))\n        .catch(() => showAlert('Promise.all - Something went wrong'))\n        .finally(() => showAlert('Promise.all - finished'))\n})()\n}}\n")),(0,a.kt)("p",null,"In the example above:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"We have a list of employee names, and we run ",(0,a.kt)("inlineCode",{parentName:"li"},"MockApi")," with parameter names as each employee name;"),(0,a.kt)("li",{parentName:"ol"},"We store the returned Promise for each ",(0,a.kt)("inlineCode",{parentName:"li"},"MockApi.run()")," in the calls array;"),(0,a.kt)("li",{parentName:"ol"},"Then, we show an alert message according to the success or failure case in ",(0,a.kt)("inlineCode",{parentName:"li"},"Promise.all()"),".")),(0,a.kt)("h4",{id:"promiseallsettled"},"Promise.allSettled()"),(0,a.kt)("p",null,"It just waits for all the promises to settle, regardless of the result (resolved or rejected)."),(0,a.kt)("p",null,"For example, Refer to the code below:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"{{\n(function(){\n\n  let employeeNames = [\"Employee 1\",\"Employee 2\"];\n\n  // Start a bunch of calls running in parallel and store returned promise\n  const calls = employeeNames.map(employeeName => MockApi.run({ name: employeeName }));\n  \n  // Wait for all to resolve / reject.\n  return Promise.allSettled(calls)\n        .then(() => showAlert('Promise.allSettled - All successful'))\n        .catch(() => showAlert('Promise.allSettled - Something went wrong'))\n        .finally(() => showAlert('Promise.allSettled - finished'))\n})()\n}}\n")),(0,a.kt)("p",null,"In the example above:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"We have a list of employee names, and we run ",(0,a.kt)("inlineCode",{parentName:"li"},"MockApi")," with parameter names as each employee name;"),(0,a.kt)("li",{parentName:"ol"},"We store the returned Promise for each ",(0,a.kt)("inlineCode",{parentName:"li"},"MockApi.run()")," in the calls array;"),(0,a.kt)("li",{parentName:"ol"},"Then, we show an alert message according to the success or failure case in ",(0,a.kt)("inlineCode",{parentName:"li"},"Promise.allSettled()"),".")),(0,a.kt)("h3",{id:"using-promises-in-appsmith"},(0,a.kt)("strong",{parentName:"h3"},"Using Promises in Appsmith")),(0,a.kt)("p",null,"Here are some general guidelines for using Promises in Appsmith:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Most action triggers in Appsmith now return promises so you can attach a ",(0,a.kt)("inlineCode",{parentName:"li"},".then / await")," to wait for the action before proceeding."),(0,a.kt)("li",{parentName:"ul"},"All triggers are wrapped in a promise, so any missed error will result in an uncaught promise error."),(0,a.kt)("li",{parentName:"ul"},"Return promise with ",(0,a.kt)("inlineCode",{parentName:"li"},".then")," attached to it.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"{{\n  (function() {\n        // the .then will not run if the promise is not returned\n        return MockApi.run()\n            .then(() => showAlert('success'))\n    })()\n}}\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Params are no longer passed in the ",(0,a.kt)("inlineCode",{parentName:"li"},".then()")," argument of the ",(0,a.kt)("inlineCode",{parentName:"li"},"action.run"),". Only the response is passed.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},'{{\n  (function() {\n        // define params on top so that you can use them in the later calls\n        const params = { name: "Appsmith" }\n        return MockApi.run(params)\n            .then((response) => {\n                showAlert(`${response.length} users found in `${params.name}`)\n            })\n    })()\n}}\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"When passing a function to ",(0,a.kt)("inlineCode",{parentName:"li"},".then()")," or ",(0,a.kt)("inlineCode",{parentName:"li"},".catch()")," always remember to pass it as a ",(0,a.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Glossary/Callback_function"},"callback")," function.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"{{\n  (function() {\n    MockApi.run().then(showAlert(`Success`))\u274c   \n    return MockApi.run().then(() => showAlert(`Success`)) \u2705\n      \n   })()\n}}\n")))}c.isMDXComponent=!0}}]);