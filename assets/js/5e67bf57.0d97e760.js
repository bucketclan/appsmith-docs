"use strict";(self.webpackChunkappsmith_docs=self.webpackChunkappsmith_docs||[]).push([[2778],{3905:(e,t,a)=>{a.d(t,{Zo:()=>d,kt:()=>h});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function i(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var p=n.createContext({}),l=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=l(e.components);return n.createElement(p.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,p=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),m=l(a),h=r,c=m["".concat(p,".").concat(h)]||m[h]||u[h]||s;return a?n.createElement(c,o(o({ref:t},d),{},{components:a})):n.createElement(c,o({ref:t},d))}));function h(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,o=new Array(s);o[0]=m;var i={};for(var p in t)hasOwnProperty.call(t,p)&&(i[p]=t[p]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var l=2;l<s;l++)o[l]=a[l];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},57469:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>l});var n=a(87462),r=(a(67294),a(3905));const s={sidebar_position:16},o="How to Use Prepared Statements?",i={unversionedId:"learning-and-resources/how-to-guides/how-to-use-prepared-statements",id:"learning-and-resources/how-to-guides/how-to-use-prepared-statements",title:"How to Use Prepared Statements?",description:"A Prepared Statement is a feature provided by Database Management Systems (DBMS) to execute the same statement with dynamic data bindings repeatedly and efficiently. It uses a pre-compiled SQL code without data to speed up the execution.",source:"@site/docs/learning-and-resources/how-to-guides/how-to-use-prepared-statements.md",sourceDirName:"learning-and-resources/how-to-guides",slug:"/learning-and-resources/how-to-guides/how-to-use-prepared-statements",permalink:"/learning-and-resources/how-to-guides/how-to-use-prepared-statements",draft:!1,editUrl:"https://github.com/bucketclan/appsmith-docs/blob/v1.5/website/docs/learning-and-resources/how-to-guides/how-to-use-prepared-statements.md",tags:[],version:"current",sidebarPosition:16,frontMatter:{sidebar_position:16},sidebar:"tutorialSidebar",previous:{title:"How to Use Elasticsearch as a Datasource on Appsmith",permalink:"/learning-and-resources/how-to-guides/how-to-use-elasticsearch-as-a-data-source-on-appsmith"},next:{title:"Sample Apps",permalink:"/learning-and-resources/sample-apps"}},p={},l=[{value:"How Do Prepared Statements Work?",id:"how-do-prepared-statements-work",level:2},{value:"Prepare",id:"prepare",level:3},{value:"Process",id:"process",level:3},{value:"Execute",id:"execute",level:3},{value:"<strong>Why Should You Use Prepared Statements?</strong>",id:"why-should-you-use-prepared-statements",level:2},{value:"<strong>Efficiency</strong>",id:"efficiency",level:3},{value:"<strong>Security</strong>",id:"security",level:3},{value:"<strong>Prepared Statement in Appsmith</strong>",id:"prepared-statement-in-appsmith",level:2},{value:"Prepared Statement Support",id:"prepared-statement-support",level:3},{value:"Enable Prepared Statement",id:"enable-prepared-statement",level:3},{value:"<strong>Using a toggle on the Query tab</strong>",id:"using-a-toggle-on-the-query-tab",level:4},{value:"<strong>Using a toggle on the Settings tab</strong>",id:"using-a-toggle-on-the-settings-tab",level:4},{value:"When to Use Prepared Statements in Appsmith",id:"when-to-use-prepared-statements-in-appsmith",level:3},{value:"Simple Prepared Statement",id:"simple-prepared-statement",level:4},{value:"<strong>Static Array Length</strong>",id:"static-array-length",level:4},{value:"When Not to Use Prepared Statements in Appsmith",id:"when-not-to-use-prepared-statements-in-appsmith",level:3},{value:"Dynamic Table Name",id:"dynamic-table-name",level:4},{value:"Dynamic Queries",id:"dynamic-queries",level:4},{value:"Dynamic Where Clause",id:"dynamic-where-clause",level:4},{value:"<strong>Quick Tips</strong>",id:"quick-tips",level:2},{value:"Conclusion",id:"conclusion",level:2}],d={toc:l};function u(e){let{components:t,...s}=e;return(0,r.kt)("wrapper",(0,n.Z)({},d,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"how-to-use-prepared-statements"},"How to Use Prepared Statements?"),(0,r.kt)("p",null,"A ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Prepared_statement"},"Prepared Statement")," is a feature provided by Database Management Systems (DBMS) to execute the same statement with dynamic data bindings repeatedly and efficiently. It uses a pre-compiled SQL code without data to speed up the execution."),(0,r.kt)("p",null,"Let's take a closer look at the prepared statement below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[Select id, name, email from users where id = ] {?};\n")),(0,r.kt)("p",null,"The SQL code enclosed in the square bracket ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"([ ])"))," will be pre-compiled, and the Question Mark ",(0,r.kt)("strong",{parentName:"p"},"(?)")," enclosed in the curly braces ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"({})"))," shows the data bindings appended at runtime based on the different values supplied by the calling application."),(0,r.kt)("p",null,"In this guide, you'll learn how to use prepared statements in Appsmith and some examples for different datasources. You'll also learn when and when not to use prepared statements."),(0,r.kt)("p",null,"To understand how prepared statements work in Appsmith, let's first understand how prepared statements work at a database level."),(0,r.kt)("h2",{id:"how-do-prepared-statements-work"},"How Do Prepared Statements Work?"),(0,r.kt)("p",null,"A prepared statement workflow consists of three stages: Prepare, Process, and Execute."),(0,r.kt)("h3",{id:"prepare"},"Prepare"),(0,r.kt)("p",null,"In the prepare stage, a statement template is sent to the database server. In this template, some values are left unspecified and called parameters labeled using a question mark (?) sign."),(0,r.kt)("p",null,"For example, in the below statement, the text in the square bracket","*","*",(0,r.kt)("inlineCode",{parentName:"p"},"([])"),"*","*"," is the statement template, and question mark signs in curly braces ","*","*",(0,r.kt)("inlineCode",{parentName:"p"},"({})"),"*","*","are the parameters supplied at runtime."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[Insert into users(name, email) values ]{(?,?)};\n")),(0,r.kt)("h3",{id:"process"},"Process"),(0,r.kt)("p",null,"The database server parses, compiles, optimizes, and stores the result without executing the statement template. The statement is optimized and ready to be executed whenever the parameters (labeled with question marks) are supplied."),(0,r.kt)("h3",{id:"execute"},"Execute"),(0,r.kt)("p",null,"Whenever the parameters are supplied for the given prepared statement, the database binds the values to the statement and executes it. The database can execute the statements as often as the application triggers by supplying the same or different parameters."),(0,r.kt)("h2",{id:"why-should-you-use-prepared-statements"},(0,r.kt)("strong",{parentName:"h2"},"Why Should You Use Prepared Statements?")),(0,r.kt)("p",null,"The benefits of using Prepared Statements are:"),(0,r.kt)("h3",{id:"efficiency"},(0,r.kt)("strong",{parentName:"h3"},"Efficiency")),(0,r.kt)("p",null,"The prepared statement uses a pre-compiled SQL code, so the code is not compiled for every execution run. It speeds up the execution, thus enhancing efficiency."),(0,r.kt)("h3",{id:"security"},(0,r.kt)("strong",{parentName:"h3"},"Security")),(0,r.kt)("p",null,"The prepared statement is a parameterized and reusable block of code. It forces the user to write the SQL command and send the user inputs data separately. Thus, the data bindings defined in the prepared statements are sent to the server to execute the pre-compiled code block and generate the response accordingly. Due to this, a prepared statement provides a secured environment and avoids ",(0,r.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/SQL_injection"},"SQL injection"),", that is the most common web hacking technique."),(0,r.kt)("h2",{id:"prepared-statement-in-appsmith"},(0,r.kt)("strong",{parentName:"h2"},"Prepared Statement in Appsmith")),(0,r.kt)("p",null,"Appsmith supports using prepared statements by converting the user query into a parameterized query by replacing the bindings. That means the query created on the Appsmith will have bindings for reading the widget values selected by users. Appsmith internally replaces these widget bindings with question marks('?') and translates Appsmith queries into Prepared Statements."),(0,r.kt)("p",null,"For example, the query created on Appsmith looks as below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"SELECT * FROM users where id = {{Table1.selectedRow.Id}};\n")),(0,r.kt)("p",null,"Appsmith internally replaces ",(0,r.kt)("inlineCode",{parentName:"p"},"{{Table1.selectedRow.Id}}")," with a question mark ",(0,r.kt)("inlineCode",{parentName:"p"},"(?)"),". The payload inserts params one by one, ensuring that the bindings get properly escaped and sanitized before the query is sent to the database for execution. Thus, translating an Appsmith query into a prepared statement."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Appsmith first ",(0,r.kt)("strong",{parentName:"p"},"sanitizes")," each input so that the apps you build on Appsmith are ",(0,r.kt)("strong",{parentName:"p"},"protected")," against ",(0,r.kt)("strong",{parentName:"p"},"SQL injection"),".")),(0,r.kt)("p",null,"For example, your query has multiple bindings as below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"SELECT * FROM users where id = {{Table1.selectedRow.Id}} and name = {{Table1.selectedRow.name}};\n")),(0,r.kt)("p",null,"For the above query, the first binding for ",(0,r.kt)("strong",{parentName:"p"},"Id")," ",(0,r.kt)("inlineCode",{parentName:"p"},"{{Table1.selectedRow.Id}}")," is set as the first parameter and second binding for ",(0,r.kt)("strong",{parentName:"p"},"name")," ",(0,r.kt)("inlineCode",{parentName:"p"},"{{Table1.selectedRow.name}}")," as second parameter."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The multiple bindings added to the Appsmith queries are translated into the number of parameters that will be supplied to a prepared statement.")),(0,r.kt)("h3",{id:"prepared-statement-support"},"Prepared Statement Support"),(0,r.kt)("p",null,"You can use prepared statements for the below datasources on Appsmith:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/reference/datasources/querying-mssql"},"MS SQL")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/reference/datasources/querying-mysql"},"MySQL")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"/reference/datasources/querying-postgres"},"PostgreSQL"))),(0,r.kt)("h3",{id:"enable-prepared-statement"},"Enable Prepared Statement"),(0,r.kt)("p",null,"To use prepared statements for a datasource, you'll have to enable the prepared statement for query execution."),(0,r.kt)("figure",null,(0,r.kt)("object",{data:"https://www.youtube.com/embed/PSw1iyyv6UM?autoplay=0",width:"750px",height:"400px"}),(0,r.kt)("figcaption",{align:"center"},(0,r.kt)("i",null,"How to enable a prepared statement"))),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Whenever you ",(0,r.kt)("strong",{parentName:"p"},"create a new query"),", the ",(0,r.kt)("strong",{parentName:"p"},"prepared statement setting")," is ",(0,r.kt)("strong",{parentName:"p"},"enabled"),". You can ",(0,r.kt)("strong",{parentName:"p"},"turn it off manually")," if you wish to.")),(0,r.kt)("p",null,"You can choose to enable or disable the prepared statement by using the ",(0,r.kt)("inlineCode",{parentName:"p"},"Use Prepared Statement")," toggle available on the ",(0,r.kt)("strong",{parentName:"p"},"Query")," screen or navigate to the ",(0,r.kt)("strong",{parentName:"p"},"Settings")," tab where the same toggle ",(0,r.kt)("inlineCode",{parentName:"p"},"Use Prepared Statement")," is available."),(0,r.kt)("h4",{id:"using-a-toggle-on-the-query-tab"},(0,r.kt)("strong",{parentName:"h4"},"Using a toggle on the Query tab")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Enable or Disable Prepared Statement from Query Tab",src:a(4541).Z,width:"2506",height:"912"})),(0,r.kt)("h4",{id:"using-a-toggle-on-the-settings-tab"},(0,r.kt)("strong",{parentName:"h4"},"Using a toggle on the Settings tab")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Enable or Disable Prepared Statement from Settings Tab",src:a(93779).Z,width:"2494",height:"866"})),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"Both the toggles ",(0,r.kt)("inlineCode",{parentName:"p"},"Use Prepared Statement"),"work in sync, and you can choose any to enable or disable the prepared statements.")),(0,r.kt)("p",null,"The ",(0,r.kt)("a",{parentName:"p",href:"/learning-and-resources/how-to-guides/how-to-use-prepared-statements#prepared-statement-support"},"above datasources have some syntactic changes")," in query creation. However, you can enable or disable the prepared statements for almost every scenario, as illustrated below."),(0,r.kt)("h3",{id:"when-to-use-prepared-statements-in-appsmith"},"When to Use Prepared Statements in Appsmith"),(0,r.kt)("p",null,"You can use prepared statements when doing dynamic data bindings in the ",(0,r.kt)("inlineCode",{parentName:"p"},"where")," clause. Remember to keep the query before the ",(0,r.kt)("inlineCode",{parentName:"p"},"where")," clause static and provide the column names used to filter the data. However, the data can be dynamically set based on the user's inputs."),(0,r.kt)("p",null,"As shown in the code snippet below, you can dynamically add the data binding embedded in the mustache sign","*","*",(0,r.kt)("inlineCode",{parentName:"p"},"({{}})"),"*","*"," based on user input."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"}," SELECT * FROM USERS WHERE ID = {{Table1.selectedRow.Id}}\n")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"You can ",(0,r.kt)("strong",{parentName:"p"},"only")," have ",(0,r.kt)("strong",{parentName:"p"},"bindings")," for the ",(0,r.kt)("strong",{parentName:"p"},"data supplied")," to the ",(0,r.kt)("strong",{parentName:"p"},"columns")," in the ",(0,r.kt)("strong",{parentName:"p"},"where")," clause while ",(0,r.kt)("strong",{parentName:"p"},"using prepared statements"),".")),(0,r.kt)("p",null,"Below are some of the example use cases showcasing when and how you can use prepared statements:"),(0,r.kt)("h4",{id:"simple-prepared-statement"},"Simple Prepared Statement"),(0,r.kt)("p",null,"You can use prepared statements whenever you want to perform a simple Create, Read, Update or Delete (CRUD) operation, which manipulates database table data with the dynamic data bindings."),(0,r.kt)("p",null,"For example, you want to create a user record into the ",(0,r.kt)("inlineCode",{parentName:"p"},"users")," table for user registration, and capture the details from a registration form available on Appsmith for your user registration application. You can create a simple insert query to capture the user's input and store the record in the ",(0,r.kt)("inlineCode",{parentName:"p"},"users")," table by enabling prepared statements."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Insert into users (name, email) values({{userRegistrationForm.data.name}}, {{userRegistrationForm.data.email}});\n")),(0,r.kt)("p",null,"Here, ",(0,r.kt)("inlineCode",{parentName:"p"},"userRegistrationForm")," is the name of the ",(0,r.kt)("a",{parentName:"p",href:"/reference/widgets/form"},"form")," widget, and ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"email")," are the names of the input widget embedded into the ",(0,r.kt)("a",{parentName:"p",href:"/reference/widgets/form"},"form"),"."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"You can use ",(0,r.kt)("strong",{parentName:"p"},"join queries")," or ",(0,r.kt)("strong",{parentName:"p"},"subqueries")," to have ",(0,r.kt)("strong",{parentName:"p"},"dynamic data binding")," as long as the ",(0,r.kt)("strong",{parentName:"p"},"query")," is ",(0,r.kt)("strong",{parentName:"p"},"static")," and ",(0,r.kt)("strong",{parentName:"p"},"only")," ",(0,r.kt)("strong",{parentName:"p"},"data")," bindings are added to the ",(0,r.kt)("strong",{parentName:"p"},"where")," clause.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Data Type Cast")),(0,r.kt)("p",null,"Appsmith out-of-the-box handles the data type casting based on the type of the data supplied for a column as a data binding."),(0,r.kt)("p",null,"For example, you are updating a user's data for the location. You are updating the latitude and longitude for the same. The latitude and longitude have values like ",(0,r.kt)("inlineCode",{parentName:"p"},"42.9756")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"105.8589")," respectively."),(0,r.kt)("p",null,"The data supplied for latitude and longitude suggests that the column could have a floating data type. If the latitude and longitude have a floating data type in your ",(0,r.kt)("inlineCode",{parentName:"p"},"users")," table, the updates will happen seamlessly with prepared statements being turned on. However, suppose the data type of latitude and longitude is anything other than float, say text. To use prepared statements, you'll have to typecast the values manually in your queries, as shown in the below code snippet:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"// you can see that **:: text** is used for latitude and \n// longitude to type cast the column data\nUpdate users set latitude = {{userUpdateForm.data.latitude}} :: text, \nlongitude = {{userUpdateForm.data.longitude}} :: text\nwhere id = {{userUpdateForm.data.id}}\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"In Clause")),(0,r.kt)("p",null,"You have a search functionality allowing users to select different statuses to filter the result. A user can select more than one status to view the data. You translate this into a select query and use an in clause which takes up an array of data, and would write a query as below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"SELECT * from users where status in ({{userStatus.selectedOptionValues}})\n")),(0,r.kt)("p",null,"Here, ",(0,r.kt)("inlineCode",{parentName:"p"},"userStatus")," is a ",(0,r.kt)("a",{parentName:"p",href:"/reference/widgets/multiselect"},"MultiSelect")," widget. There are two scenarios for the ",(0,r.kt)("inlineCode",{parentName:"p"},"in clause")," queries; You don't know how many options the user will select, so you will supply a dynamic length of an array, or you know the data bindings and so supply a static length of the array to the in clause."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Dynamic Array Length")),(0,r.kt)("p",null,"When you supply an array with varying lengths, you generate a dynamic ",(0,r.kt)("inlineCode",{parentName:"p"},"in clause")," with indefinite bindings determined at runtime. The problem with using an array for generating a dynamic ",(0,r.kt)("inlineCode",{parentName:"p"},"in clause")," is that no definite values are available as selected options are not fixed and may vary. Because of this, the binding to the number of parameters with the query will fail."),(0,r.kt)("p",null,"To use prepared statements for queries which dynamic data bindings for in clause, you can use a query as below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"SELECT * from users where status in = ANY ({{userStatus.selectedOptionValues}})\n")),(0,r.kt)("p",null,"The above query will bind the parameters and sanitize the values for your queries."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("inlineCode",{parentName:"strong"},"= ANY"))," combination is ",(0,r.kt)("strong",{parentName:"p"},"supported")," on ",(0,r.kt)("a",{parentName:"p",href:"/reference/datasources/querying-postgres"},(0,r.kt)("strong",{parentName:"a"},"PostgreSQL")),", but ",(0,r.kt)("a",{parentName:"p",href:"/reference/datasources/querying-mysql"},(0,r.kt)("strong",{parentName:"a"},"MySQL"))," ",(0,r.kt)("strong",{parentName:"p"},"doesn\u2019t")," ",(0,r.kt)("strong",{parentName:"p"},"support")," it. For ",(0,r.kt)("a",{parentName:"p",href:"/reference/datasources/querying-mysql"},(0,r.kt)("strong",{parentName:"a"},"MySQL")),", when you have a dynamic array binding, you'll have to use it by ",(0,r.kt)("strong",{parentName:"p"},"disabling prepared statements"),".")),(0,r.kt)("h4",{id:"static-array-length"},(0,r.kt)("strong",{parentName:"h4"},"Static Array Length")),(0,r.kt)("p",null,"When you know that the ",(0,r.kt)("inlineCode",{parentName:"p"},"in clause")," will have a fixed number of data bindings you capture by different widgets, it is static. Here, you are aware of the number of data bindings present for an ",(0,r.kt)("inlineCode",{parentName:"p"},"in clause"),". The prepared statement can work for such bindings, and you can write a query as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"SELECT * from users where status in ({{userActiveStatus.text}} , {{userInActiveStatus.text}})\n")),(0,r.kt)("p",null,"Here, the ",(0,r.kt)("inlineCode",{parentName:"p"},"userActiveStatus")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"userInActiveStatus")," are two different ",(0,r.kt)("a",{parentName:"p",href:"/reference/widgets/text"},"text widgets")," that are ",(0,r.kt)("strong",{parentName:"p"},"added as")," data binding for in clause."),(0,r.kt)("h3",{id:"when-not-to-use-prepared-statements-in-appsmith"},"When Not to Use Prepared Statements in Appsmith"),(0,r.kt)("p",null,"You can choose to turn off the prepared statement use when your query falls under one of the below criteria:"),(0,r.kt)("h4",{id:"dynamic-table-name"},"Dynamic Table Name"),(0,r.kt)("p",null,"You are generating a table name dynamically based on some criteria in your code logic and then supplying it as a binding to the query."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Select * from {{Generated_Table_Name.text}} \n")),(0,r.kt)("p",null,"In this query, you read the table name from a ",(0,r.kt)("a",{parentName:"p",href:"/reference/widgets/text"},"Text widget "),(0,r.kt)("strong",{parentName:"p"},"(Generated","_","Table","_","Name)"),", and as the query does not have a static block that tells which table to refer to the prepared statements fail to execute the binding. In such cases, you can turn off the prepared statements and continue to use the query to generate responses."),(0,r.kt)("h4",{id:"dynamic-queries"},"Dynamic Queries"),(0,r.kt)("p",null,"You generate the query on the fly based on some parameters and then execute it. For example, ",(0,r.kt)("inlineCode",{parentName:"p"},"{{Query_to_Execute.text}}")," where the ",(0,r.kt)("a",{parentName:"p",href:"/reference/widgets/text"},"Text Widget")," ",(0,r.kt)("strong",{parentName:"p"},"(Query","_","to","_","Execute)")," has the query that will be executed, which could be generated on the fly based on some logic in the code. As the static query that will be executed is not available for pre-compilation, the prepared statements fail to execute. For such scenarios, you can disable the prepared statements and continue to use the query to generate responses."),(0,r.kt)("h4",{id:"dynamic-where-clause"},"Dynamic Where Clause"),(0,r.kt)("p",null,"You want to generate a where clause based on some code logic. For example, you have a search feature where a user can select some parameters to filter the data. If the user selects particular criteria, you add that to the where clause to filter the records. The user may choose not to add the parameter, so the where clause will not have a column for filtering. It means you are dynamically generating the column name bindings and the data for the columns based on the user's input."),(0,r.kt)("p",null,"For such scenarios, the query can't be pre-compiled as there are too many unknowns, and every run could result in a different query, so the prepared statements fail to execute. You can toggle off the prepared statement and continue to use the query for result generation."),(0,r.kt)("p",null,"Look at the code snippet below, where you are generating a ",(0,r.kt)("inlineCode",{parentName:"p"},"where")," clause with a null check."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'SELECT * FROM users WHERE {{ !!Input1.text ? "name =" +  Input1.text : "name IS NULL" }}\n')),(0,r.kt)("p",null,"For the above scenario, also turn off the prepared statement. The query can\u2019t be pre-compiled and will be evaluated as a new query for every run, as the where clause is dynamically generated and evaluated at runtime."),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"A ",(0,r.kt)("strong",{parentName:"p"},"prepared statement")," ",(0,r.kt)("strong",{parentName:"p"},"requires")," you to supply ",(0,r.kt)("strong",{parentName:"p"},"a static part of the query")," to understand the ",(0,r.kt)("strong",{parentName:"p"},"type of operation")," (Create, Read, Update or Delete) performed on the database table (Table name) and the ",(0,r.kt)("strong",{parentName:"p"},"columns")," that will be used in the ",(0,r.kt)("strong",{parentName:"p"},"where")," clause to filter the data from the database table.")),(0,r.kt)("h2",{id:"quick-tips"},(0,r.kt)("strong",{parentName:"h2"},"Quick Tips")),(0,r.kt)("p",null,"A few quick tips to remember so that you can quickly steer it through when using prepared statements:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The commented code blocks in your queries should not have any bindings, as when you enable the prepared statement, it translates all the bindings. As the commented block has bindings, the translation will fail, and you will not be able to run the queries. To avoid this, remove the mustache ",(0,r.kt)("strong",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"strong"},"{{}}"))," sign around the binding whenever you are commenting code, and the prepared statement will work."),(0,r.kt)("li",{parentName:"ul"},"If you are using a dynamic array to supply the ",(0,r.kt)("inlineCode",{parentName:"li"},"in clause")," and using ",(0,r.kt)("a",{parentName:"li",href:"/reference/datasources/querying-postgres"},"PostgreSQL"),", then you can use ",(0,r.kt)("inlineCode",{parentName:"li"},"= ANY"),". However, turn off the prepared statements to run the query if you are on ",(0,r.kt)("a",{parentName:"li",href:"/reference/datasources/querying-mysql"},"MySQL"),".")),(0,r.kt)("h2",{id:"conclusion"},"Conclusion"),(0,r.kt)("p",null,"Prepared statements bring ",(0,r.kt)("a",{parentName:"p",href:"/learning-and-resources/how-to-guides/how-to-use-prepared-statements#efficiency"},"efficiency")," and ",(0,r.kt)("a",{parentName:"p",href:"/learning-and-resources/how-to-guides/how-to-use-prepared-statements#security"},"security")," to the data manipulation for the apps built on Appsmith. With sanitization done out-of-the-box by Appsmith for prepared statements, you can seamlessly build complex apps that suit your requirements."))}u.isMDXComponent=!0},4541:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/How-to-guide_Prepared_Statements__Enable_Prepared_Statement__Query__Query_tab-63a00d0fd0063384e8e4008488121f8e.png"},93779:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/How-to-guide_Prepared_Statements__Enable_Prepared_Statement__Query__Settings_tab-07fbe3d8d0da24809da8f723fcc34874.png"}}]);